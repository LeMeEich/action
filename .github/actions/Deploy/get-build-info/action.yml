name: 'Get Build Info'
description: 'Busca informaÃ§Ãµes de um build pelo Run ID'

inputs:
  run_id:
    description: 'Run ID do build'
    required: true
  github_token:
    description: 'GitHub Token'
    required: true

outputs:
  build_number:
    description: 'NÃºmero do build'
    value: ${{ steps.get_info.outputs.build_number }}
  artifact_name:
    description: 'Nome do artefato'
    value: ${{ steps.get_info.outputs.artifact_name }}

runs:
  using: 'composite'
  steps:
    - name: Get Build Info
      id: get_info
      shell: bash
      run: |
        echo "ðŸ“¦ Buscando informaÃ§Ãµes do Build (Run ID: ${{ inputs.run_id }})..."
        
        # Busca informaÃ§Ãµes do build pela API
        BUILD_INFO=$(curl -s -H "Authorization: Bearer ${{ inputs.github_token }}" \
          -H "Accept: application/vnd.github+json" \
          "https://api.github.com/repos/${{ github.repository }}/actions/runs/${{ inputs.run_id }}")
        
        BUILD_NUMBER=$(echo "$BUILD_INFO" | jq -r '.run_number')
        ARTIFACT_NAME=$(echo "$BUILD_INFO" | jq -r '.name')
        
        if [ -z "$BUILD_NUMBER" ] || [ "$BUILD_NUMBER" = "null" ]; then
          echo "âŒ Build nÃ£o encontrado"
          exit 1
        fi
        
        echo "âœ… Build #$BUILD_NUMBER encontrado"
        echo "build_number=$BUILD_NUMBER" >> $GITHUB_OUTPUT
        echo "artifact_name=build-v1.0.$BUILD_NUMBER" >> $GITHUB_OUTPUT
        
        # Atualiza o nome do job com o nÃºmero do build
        echo "::notice title=Deploy::Build #$BUILD_NUMBER â†’ ${{ github.event.inputs.environment }}"
