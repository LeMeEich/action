name: Deploy

on:
  workflow_run:
    workflows: ["Build"]
    types:
      - completed
  workflow_dispatch:
    inputs:
      version:
        description: 'Build version to deploy (e.g., v1.0.123)'
        required: true
        type: string

jobs:
  deploy-des:
    name: Deploy to DES
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build-${{ github.event_name == 'workflow_dispatch' && inputs.version || format('v1.0.{0}', github.event.workflow_run.run_number) }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Deploy to DES
        run: |
          echo "ðŸš€ Deploy to DES"
          cat build-info.txt
          cat teste.txt
          echo "Environment: DES"

  deploy-pre:
    name: Deploy to PRE
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build-${{ github.event_name == 'workflow_dispatch' && inputs.version || format('v1.0.{0}', github.event.workflow_run.run_number) }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Deploy to PRE
        run: |
          echo "ðŸš€ Deploy to PRE"
          cat build-info.txt
          cat teste.txt
          echo "Environment: PRE"

  deploy-prod:
    name: Deploy to PROD
    runs-on: ubuntu-latest
    needs: deploy-pre
    if: github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: build-${{ github.event_name == 'workflow_dispatch' && inputs.version || format('v1.0.{0}', github.event.workflow_run.run_number) }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Deploy to PROD
        run: |
          echo "ðŸš€ Deploy to PROD"
          cat build-info.txt
          cat teste.txt
          echo "Environment: PROD"
