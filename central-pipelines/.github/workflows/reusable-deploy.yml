name: Reusable Deploy Workflow

on:
  workflow_call:
    inputs:
      environment:
        description: 'Ambiente de deploy (dev, pre, prod)'
        required: true
        type: string
      artifact-name:
        description: 'Nome do artifact a ser deployado'
        required: true
        type: string
      version:
        description: 'Vers√£o a ser deployada'
        required: true
        type: string
      deploy-url:
        description: 'URL do ambiente'
        required: false
        type: string
        default: ''
    secrets:
      deploy-token:
        description: 'Token para autentica√ß√£o no deploy'
        required: false

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ inputs.artifact-name }}
          path: ./build

      - name: Validar artifact
        run: |
          echo "üì¶ Validando artifact..."
          if [ ! -f ./build/build-info.txt ]; then
            echo "‚ùå Erro: Arquivo build-info.txt n√£o encontrado!"
            exit 1
          fi
          echo "‚úÖ Artifact validado com sucesso!"

      - name: Exibir informa√ß√µes do build
        run: |
          echo "================================================"
          echo "üìã INFORMA√á√ïES DO BUILD"
          echo "================================================"
          cat ./build/build-info.txt
          echo "================================================"

      - name: Deploy para ${{ inputs.environment }}
        run: |
          echo "üöÄ Iniciando deploy..."
          echo "   Ambiente: ${{ inputs.environment }}"
          echo "   Vers√£o: ${{ inputs.version }}"
          echo "   Artifact: ${{ inputs.artifact-name }}"
          
          # Aqui voc√™ pode adicionar seus comandos de deploy reais
          # Exemplos:
          # - Deploy para S3/Azure Blob
          # - Deploy para Kubernetes
          # - Deploy para servidor via SSH
          # - Notifica√ß√£o para webhooks
          
          if [ -n "${{ inputs.deploy-url }}" ]; then
            echo "   URL: ${{ inputs.deploy-url }}"
          fi
          
          echo "‚úÖ Deploy conclu√≠do com sucesso!"

      - name: Notifica√ß√£o de sucesso
        if: success()
        run: |
          echo "‚úÖ Deploy para ${{ inputs.environment }} realizado com sucesso!"
          echo "   Vers√£o: ${{ inputs.version }}"

      - name: Notifica√ß√£o de falha
        if: failure()
        run: |
          echo "‚ùå Falha no deploy para ${{ inputs.environment }}"
          echo "   Vers√£o: ${{ inputs.version }}"
